(function(e){var t=0,n=e.MediaSource||e.WebKitMediaSource||{},r=e.URL||{},i,s=/video\/flv; codecs=["']vp6,aac["']/,o="blob:vjs-media-source/";i=function(){};i.prototype.init=function(){this.listeners=[]};i.prototype.addEventListener=function(e,t){if(!this.listeners[e]){this.listeners[e]=[]}this.listeners[e].unshift(t)};i.prototype.trigger=function(e){var t=this.listeners[e.type]||[],n=t.length;while(n--){t[n](e)}};videojs.MediaSource=function(){var e=this;videojs.MediaSource.prototype.init.call(this);this.sourceBuffers=[];this.readyState="closed";this.listeners={sourceopen:[function(t){e.swfObj=document.getElementById(t.swfId);e.readyState="open";if(e.swfObj){e.swfObj.vjs_load()}}],webkitsourceopen:[function(t){e.trigger({type:"sourceopen"})}]}};videojs.MediaSource.prototype=new i;videojs.MediaSource.prototype.addSourceBuffer=function(e){var t;if(s.test(e)){t=new videojs.SourceBuffer(this)}else{t=this.nativeSource.addSourceBuffer.apply(this.nativeSource,arguments)}this.sourceBuffers.push(t);return t};videojs.MediaSource.prototype.endOfStream=function(){this.swfObj.vjs_endOfStream();this.readyState="ended"};videojs.mediaSources={};videojs.MediaSource.open=function(e,t){var n=videojs.mediaSources[e];if(n){n.trigger({type:"sourceopen",swfId:t})}else{throw new Error("Media Source not found (Video.js)")}};videojs.SourceBuffer=function(e){videojs.SourceBuffer.prototype.init.call(this);this.source=e;this.buffer=[]};videojs.SourceBuffer.prototype=new i;videojs.SourceBuffer.prototype.appendBuffer=function(t){var n="",r=0,i=t.byteLength,s;this.buffer.push(t);for(r=0;r<i;r++){n+=String.fromCharCode(t[r])}s=e.btoa(n);this.trigger({type:"update"});this.source.swfObj.CallFunction('<invoke name="vjs_appendBuffer"'+'returntype="javascript"><arguments><string>'+s+"</string></arguments></invoke>");this.trigger({type:"updateend"})};videojs.URL={createObjectURL:function(e){var n=o+t;t++;videojs.mediaSources[n]=e;return n}};videojs.plugin("mediaSource",function(e){var t=this;t.on("loadstart",function(){var e=t.currentSrc(),i=function(e){s.trigger(e)},s;if(t.techName==="Html5"&&e.indexOf(o)===0){s=videojs.mediaSources[e];if(!s.nativeUrl){s.nativeSource=new n;s.nativeSource.addEventListener("sourceopen",i,false);s.nativeSource.addEventListener("webkitsourceopen",i,false);s.nativeUrl=r.createObjectURL(s.nativeSource)}t.src(s.nativeUrl)}})})})(this)
